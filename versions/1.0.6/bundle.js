(()=>{"use strict";var e=function(e,t,n,o){return new(n||(n=Promise))((function(i,r){function c(e){try{d(o.next(e))}catch(e){r(e)}}function a(e){try{d(o.throw(e))}catch(e){r(e)}}function d(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(c,a)}d((o=o.apply(e,t||[])).next())}))},t=function(e,t){var n,o,i,r,c={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(a){return function(d){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,a[0]&&(c=0)),c;)try{if(n=1,o&&(i=2&a[0]?o.return:a[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,a[1])).done)return i;switch(o=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return c.label++,{value:a[1],done:!1};case 5:c.label++,o=a[1],a=[0];continue;case 7:a=c.ops.pop(),c.trys.pop();continue;default:if(!((i=(i=c.trys).length>0&&i[i.length-1])||6!==a[0]&&2!==a[0])){c=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){c.label=a[1];break}if(6===a[0]&&c.label<i[1]){c.label=i[1],i=a;break}if(i&&c.label<i[2]){c.label=i[2],c.ops.push(a);break}i[2]&&c.ops.pop(),c.trys.pop();continue}a=t.call(e,c)}catch(e){a=[6,e],o=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,d])}}},n=document.createElement("div");n.className="resize-module resize-module_disable",n.insertAdjacentHTML("beforeend",'<div class="resize-module-background"></div> <div class="resize-module-container"> <div class="resize-module-container__header"> <div class="resize-module-container__header-text">Ваша фотография</div> <div class="resize-module-container__close-button"></div> </div> <p class="resize-module-container__body-text">Выбранная область будет показываться на вашей странице</p> <p class="resize-module-container__body-paragraph">Вы можете изменять размер изображения при помощи колёсика мыши</p> <div class="zoom-variant-container"> <div data-type="wheel" class="zoom-variant-item zoom-variant-item_type_wheel"></div> <div data-type="arrows" class="zoom-variant-item zoom-variant-item_type_arrows"></div> <div data-type="area" class="zoom-variant-item zoom-variant-item_type_area"></div> </div> <div class="resize-module-container__body resize-module-container__body_type_wheel"> <div class="resize-module-container__body-box resize-module-container__body-box_type_wheel"> <div class="resize-module-container__body-file resize-module-container__file_place-back resize-module-container__file_place-back_t_w"> </div> <div class="resize-module-container__circle-box resize-module-container__circle-box_type_wheel"> <div class="resize-module-container__body-file resize-module-container__file_place-front resize-module-container__file_place-front_t_w"> </div> </div> </div> </div> <div class="resize-module-container__body resize-module-container__body_type_arrows"> <div class="resize-module-container__body-box resize-module-container__body-box_type_arrows"> <div class="resize-module-container__body-file resize-module-container__file_place-back resize-module-container__file_place-back_t_a"> </div> <div class="resize-module-container__circle-box resize-module-container__circle-box_type_arrows"> <div class="resize-module-container__body-file resize-module-container__file_place-front resize-module-container__file_place-front_t_a"> </div> </div> <div class="resize-module-container__zoom-arrows"> <div class="resize-module-container__zoom-button resize-module-container__zoom-button_place_top"></div> <div class="resize-module-container__zoom-button resize-module-container__zoom-button_place_bottom"></div> </div> </div> </div> <div class="resize-module-container__body resize-module-container__body_type_area"> <div class="resize-module-container__body-box resize-module-container__body-box_type_area"> <div class="resize-module-container__body-image resize-module-container__file_place-back_t_area"> <div class="resize-module-container__background-box"> <div class="resize-module-container__background resize-module-container__background_pos_t"></div> <div class="resize-module-container__background resize-module-container__background_pos_l"></div> <div class="resize-module-container__background resize-module-container__background_pos_b"></div> <div class="resize-module-container__background resize-module-container__background_pos_r"></div> </div> <div class="resize-module-container__body-image-area resize-module-container__file_place-front_t_area"> <div class="scale-cube scale-cube_pos_tl"></div> <div class="scale-cube scale-cube_pos_tr"></div> <div class="scale-cube scale-cube_pos_bl"></div> <div class="scale-cube scale-cube_pos_br"></div> </div> </div> </div> </div> <div class="resize-module-container__footer"> <div class="resize-module-container__button resize-module-container__button_type-confirm"> <span>Сохранить изменения</span> </div> <div class="resize-module-container__button resize-module-container__button_type-deny"> <span>Вернуться назад</span> </div> </div> <canvas class="canvas_crop"></canvas> </div> '),document.body.appendChild(n);var o,i,r,c,a,d,l,s,u,_,m=document.querySelectorAll('input[class="imageResizeAndCrop"]'),v=new DataTransfer,p=document.querySelector(".resize-module-container__circle-box_type_wheel"),h=document.querySelector(".resize-module-container__circle-box_type_arrows"),y=p.getBoundingClientRect(),b=h.getBoundingClientRect(),f=500,g=500,z=0,w=0,x=1,k=0,S="area",L=document.querySelector(".resize-module-container__body-paragraph"),q={wheel:"Вы можете изменять размер изображения при помощи колёсика мыши",arrows:"Вы можете изменять размер изображения при помощи стягивания углов",area:"Вы можете выделить необходимый участок изображения"},E=document.querySelector(".resize-module-container__file_place-back_t_w"),C=document.querySelector(".resize-module-container__file_place-front_t_w"),B=document.querySelector(".resize-module-container__file_place-back_t_a"),R=document.querySelector(".resize-module-container__file_place-front_t_a"),Y=document.querySelector(".resize-module-container__file_place-back_t_area"),M=document.querySelector(".resize-module-container__file_place-front_t_area"),X=0,A=0,I=0,P=0;n.addEventListener("selectstart",(function(e){return e.preventDefault()}));var D=new FileReader,F=document.querySelectorAll("[data-type]"),j=function(n,o){return e(void 0,[n,o],void 0,(function(e,n){var o,i,r=n.quality,c=void 0===r?1:r,a=n.type,d=void 0===a?e.type:a;return t(this,(function(t){switch(t.label){case 0:return[4,createImageBitmap(e)];case 1:return o=t.sent(),(i=document.createElement("canvas")).width=o.width,i.height=o.height,i.getContext("2d").drawImage(o,0,0),[4,new Promise((function(e){return i.toBlob(e,d,c)}))];case 2:return[2,t.sent()]}}))}))},H=function(e){y=p.getBoundingClientRect(),b=h.getBoundingClientRect(),f=y.width+b.width,g=y.height+b.height;var t=Y.getBoundingClientRect();E.style.backgroundSize=e+"px",C.style.backgroundSize=e+"px",B.style.backgroundSize=e+"px",R.style.backgroundSize=e+"px",M.style.height=t.height-X-I+"px",M.style.width=t.width-A-P+"px",document.querySelector(".resize-module-container__background_pos_t").style.height=X+"px",document.querySelector(".resize-module-container__background_pos_b").style.height=I+"px",document.querySelector(".resize-module-container__background_pos_l").style.top=X+"px",document.querySelector(".resize-module-container__background_pos_l").style.bottom=I+"px",document.querySelector(".resize-module-container__background_pos_l").style.width=A+"px",document.querySelector(".resize-module-container__background_pos_r").style.top=X+"px",document.querySelector(".resize-module-container__background_pos_r").style.bottom=I+"px",document.querySelector(".resize-module-container__background_pos_r").style.width=P+"px"},N=function(e,t){y=p.getBoundingClientRect(),b=h.getBoundingClientRect(),f=y.width+b.width,g=y.height+b.height,E.style.backgroundPosition=e+" "+t,C.style.backgroundPosition=e+" "+t,B.style.backgroundPosition=e+" "+t,R.style.backgroundPosition=e+" "+t,M.style.backgroundPosition=-A+"px "+-X+"px",M.style.left=A+"px",M.style.right=P+"px",M.style.top=X+"px",M.style.bottom=I+"px"};!function(){m.forEach((function(a){a.addEventListener("change",(function(){o=a,function(){e(this,void 0,void 0,(function(){var e,i;return t(this,(function(t){switch(t.label){case 0:return n.classList.remove("resize-module_disable"),e=o.files[0],[4,j(e,{quality:Math.min(1,2097152/e.size),type:"image/jpeg"})];case 1:return i=t.sent(),D.readAsDataURL(i),D.addEventListener("load",(function(){(c=new Image).src=D.result,c.addEventListener("load",u),window.addEventListener("resize",_)})),W(),[2]}}))}))}()})),i=Number(a.getAttribute("data-target-width")),r=Number(a.getAttribute("data-target-height"))}));var u=function(){y=p.getBoundingClientRect(),b=h.getBoundingClientRect(),f=y.width+b.width,g=y.height+b.height,f+g===0&&(f=500,g=500),a=c.naturalWidth,d=c.naturalHeight,E.style.backgroundImage="url('"+D.result+"')",C.style.backgroundImage="url('"+D.result+"')",B.style.backgroundImage="url('"+D.result+"')",R.style.backgroundImage="url('"+D.result+"')";var e=a/Math.min(window.innerWidth,900),t=d/Math.min(window.innerHeight-200,600),n=Math.min(e,t);Y.style.width=a/n-88+"px",Y.style.height=d/n-88+"px",Y.style.backgroundSize=a/n-88+"px "+(d/n-88)+"px",Y.style.backgroundImage="url('"+D.result+"')";var o=Y.getBoundingClientRect();o.width<=300?(A=0,X=0,P=0,I=o.height-o.width):(A=50,X=50,P=o.width-300,I=o.height-300),w=0,z=0,x=f*Math.max(f/i,1)/Math.min(a,d),k=0,s=d*x,H(l=a*x),N("50%","50%")},_=function(){window.innerWidth<=720&&(S="area",W()),window.requestAnimationFrame(u)};window.removeEventListener("resize",_);var M,T,W=function(){for(var e=0,t=Array.from(F);e<t.length;e++){var n=t[e].dataset.type;document.querySelector(".resize-module-container__body_type_"+n).style.display="none",document.querySelector(".zoom-variant-item_type_"+n).style.backgroundColor="transparent"}L.textContent=q[S],document.querySelector(".resize-module-container__body_type_"+S).style.display="flex",document.querySelector(".zoom-variant-item_type_"+S).style.backgroundColor="var(--color-active)"};!function(){for(var e=function(e){var t=e.dataset.type;document.querySelector(".zoom-variant-item_type_"+t).addEventListener("click",(function(){S=t,W()}))},t=0,n=Array.from(F);t<n.length;t++)e(n[t])}(),M=document.querySelector(".resize-module-container__button_type-confirm"),T=document.querySelector(".canvas_crop"),M.addEventListener("click",(function(){if("area"===S){var e=Y.getBoundingClientRect(),t=a/e.width,l=d/e.height;T.width=i,T.height=r,(s=T.getContext("2d")).drawImage(c,A*t,X*l,a-A*t-P*t,d-X*l-I*l,0,0,T.width,T.height)}else{T.width=i,T.height=r;var s=T.getContext("2d"),u=a/2-z/x-f/2/x,_=d/2-w/x-g/2/x,m=f/x,p=g/x;s.drawImage(c,u,_,m,p,0,0,T.width,T.height)}T.toBlob((function(e){v.items.clear(),v.items.add(new File([e],"updatedFile.png",{type:"image/png"})),o.files=v.files,n.classList.add("resize-module_disable")}))})),function(){window.removeEventListener("resize",_);var e=function(){n.classList.add("resize-module_disable"),o.files=null,o.value=""};document.querySelector(".resize-module-container__button_type-deny").addEventListener("click",e),document.querySelector(".resize-module-container__close-button").addEventListener("click",e)}()}(),function(){var e,t,n,o,i,r=0;n=function(n){x=1+k+(n.clientX-e+(n.clientY-t))/(100+Math.sqrt((n.clientX-e)*(n.clientX-e)+(n.clientY-t)*(n.clientY-t))),4===r&&(x=1+k-(n.clientX-e+(n.clientY-t))/(100+Math.sqrt((n.clientX-e)*(n.clientX-e)+(n.clientY-t)*(n.clientY-t)))),(a*x<f||d*x<g)&&(x=f/Math.min(a,d),k=x-1),l=a*x,s=d*x,document.querySelector(".resize-module-container__zoom-button_place_top").style.margin=(32*x+4)/(x+4)+"px",document.querySelector(".resize-module-container__zoom-button_place_bottom").style.margin=(32*x+4)/(x+4)+"px",v(),H(l)},o=function(o){e=o.clientX,t=o.clientY,document.addEventListener("mousemove",n)},document.querySelector(".resize-module-container__zoom-button_place_top").addEventListener("mousedown",(function(e){r=2,o(e)})),document.querySelector(".resize-module-container__zoom-button_place_bottom").addEventListener("mousedown",(function(e){r=4,o(e)})),document.addEventListener("mouseup",(function(){k=x-1,document.removeEventListener("mousemove",n)})),i=function(e){x-=e.deltaY/2400,a*x>=f&&d*x>=g?(l=a*x,s=d*x):x+=e.deltaY/2400,v(),H(l)},"onwheel"in document?E.addEventListener("wheel",i):"onmousewheel"in document?E.addEventListener("mousewheel",i):E.addEventListener("MozMousePixelScroll",i),function(){var e,t,n,o,i=function(i){n=e,o=t,Object.prototype.hasOwnProperty.call(i,"touches")?(e=i.touches[0].clientX,t=i.touches[0].clientY):(e=i.clientX,t=i.clientY)},c=function(n){n.preventDefault();var o=Y.getBoundingClientRect();i(n),1===r?(u=A+o.left,_=o.height+o.top-I):2===r?(u=o.width+o.left-P,_=o.height+o.top-I):3===r?(u=o.width+o.left-P,_=X+o.top):4===r?(u=A+o.left,_=X+o.top):(u=e,_=t,X<=t-o.top&&I<=o.top+o.height-t&&A<=e-o.left&&P<=o.left+o.width-e&&(r=-1)),document.addEventListener("touchmove",a),document.addEventListener("mousemove",a)};Y.addEventListener("mousedown",c),Y.addEventListener("touchstart",c),document.querySelector(".scale-cube_pos_tr").addEventListener("mousedown",(function(){r=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("mousedown",(function(){r=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("mousedown",(function(){r=3})),document.querySelector(".scale-cube_pos_br").addEventListener("mousedown",(function(){r=4})),document.querySelector(".scale-cube_pos_tr").addEventListener("touchstart",(function(){r=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("touchstart",(function(){r=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("touchstart",(function(){r=3})),document.querySelector(".scale-cube_pos_br").addEventListener("touchstart",(function(){r=4}));var a=function(c){var a=Y.getBoundingClientRect();i(c);var d=0,s=0,m=0;-1!==r&&(1===r?(A=u,I=a.height-_):2===r?(P=a.width-u,I=a.height-_):3===r?(P=a.width-u,X=_):4===r&&(A=u,X=_),e>=u?(d=1,A=u-a.left,P=a.width+a.left-e):(d=-1,A=e-a.left,P=a.width+a.left-u),t>=_?(s=1,X=_-a.top,I=a.height+a.top-t):(s=-1,X=t-a.top,I=a.height+a.top-_),1===d&&-1===s?m=1:-1===d&&-1===s?m=2:-1===d&&1===s?m=3:1===d&&1===s&&(m=4)),1!==m&&2!==m||(X=t-a.top)<0&&(X=0),3!==m&&4!==m||(I=a.top+a.height-t)<0&&(I=0),2!==m&&3!==m||(A=e-a.left)<0&&(A=0),4!==m&&1!==m||(P=a.left+a.width-e)<0&&(P=0);var v=a.width-A-P,p=a.height-X-I;1===m?v<=p?X+=p-v:P+=v-p:2===m?v<=p?X+=p-v:A+=v-p:3===m?v<=p?I+=p-v:A+=v-p:4===m?v<=p?I+=p-v:P+=v-p:-1===r&&(A+=e-n,P-=e-n,X+=t-o,I-=t-o,n=e,o=t),X<0&&(I+=X,X=0),A<0&&(P+=A,A=0),I<0&&(X+=I,I=0),P<0&&(A+=P,P=0),H(l),N(z,w)},d=function(){r=0,document.removeEventListener("mousemove",a),document.removeEventListener("touchmove",a)};document.addEventListener("mouseup",d),document.addEventListener("touchend",d)}();var c,m,v=function(){2*z+f>l?z=l/2-f/2:2*z-f<-l&&(z=-l/2+f/2),2*w+g>s?w=s/2-g/2:2*w-g<-s&&(w=-s/2+g/2),N("calc(50% + "+z+"px)","calc(50% + "+w+"px)")};c=function(n){var o=n.clientX,i=n.clientY;z=o-e,w=i-t,v()},m=function(n){e=n.clientX-z,t=n.clientY-w,document.addEventListener("mousemove",c)},E.addEventListener("mousedown",m),B.addEventListener("mousedown",m),Y.addEventListener("mousedown",m),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",c)}))}()})();