(()=>{"use strict";var e=function(e,t){return n=void 0,o=[e,t],r=function(e,t){var n,o,i=t.quality,r=void 0===i?1:i,a=t.type,c=void 0===a?e.type:a;return function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}(this,(function(t){switch(t.label){case 0:return[4,createImageBitmap(e)];case 1:return n=t.sent(),(o=document.createElement("canvas")).width=n.width,o.height=n.height,o.getContext("2d").drawImage(n,0,0),[4,new Promise((function(e){return o.toBlob(e,c,r)}))];case 2:return[2,t.sent()]}}))},new((i=void 0)||(i=Promise))((function(e,t){function a(e){try{l(r.next(e))}catch(e){t(e)}}function c(e){try{l(r.throw(e))}catch(e){t(e)}}function l(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,c)}l((r=r.apply(n,o||[])).next())}));var n,o,i,r},t=document.createElement("div");t.className="resize-module resize-module_disable",t.insertAdjacentHTML("beforeend",'<div class="resize-module-background"></div> <div class="resize-module-container"> <div class="resize-module-container__header"> <div class="resize-module-container__header-text">Ваша фотография</div> <div class="resize-module-container__close-button"></div> </div> <p class="resize-module-container__body-text">Выбранная область будет показываться на вашей странице</p> <p class="resize-module-container__body-paragraph">Вы можете изменять размер изображения при помощи колёсика мыши</p> <div class="zoom-variant-container"> <div data-type="wheel" class="zoom-variant-item zoom-variant-item_type_wheel"></div> <div data-type="arrows" class="zoom-variant-item zoom-variant-item_type_arrows"></div> <div data-type="area" class="zoom-variant-item zoom-variant-item_type_area"></div> </div> <div class="resize-module-container__body resize-module-container__body_type_wheel"> <div class="resize-module-container__body-box resize-module-container__body-box_type_wheel"> <div class="resize-module-container__body-file resize-module-container__file_place-back resize-module-container__file_place-back_t_w"> </div> <div class="resize-module-container__circle-box resize-module-container__circle-box_type_wheel"> <div class="resize-module-container__body-file resize-module-container__file_place-front resize-module-container__file_place-front_t_w"> </div> </div> </div> </div> <div class="resize-module-container__body resize-module-container__body_type_arrows"> <div class="resize-module-container__body-box resize-module-container__body-box_type_arrows"> <div class="resize-module-container__body-file resize-module-container__file_place-back resize-module-container__file_place-back_t_a"> </div> <div class="resize-module-container__circle-box resize-module-container__circle-box_type_arrows"> <div class="resize-module-container__body-file resize-module-container__file_place-front resize-module-container__file_place-front_t_a"> </div> </div> <div class="resize-module-container__zoom-arrows"> <div class="resize-module-container__zoom-button resize-module-container__zoom-button_place_top"></div> <div class="resize-module-container__zoom-button resize-module-container__zoom-button_place_bottom"></div> </div> </div> </div> <div class="resize-module-container__body resize-module-container__body_type_area"> <div class="resize-module-container__body-box resize-module-container__body-box_type_area"> <div class="resize-module-container__body-image resize-module-container__file_place-back_t_area"> <div class="resize-module-container__background-box"> <div class="resize-module-container__background resize-module-container__background_pos_t"></div> <div class="resize-module-container__background resize-module-container__background_pos_l"></div> <div class="resize-module-container__background resize-module-container__background_pos_b"></div> <div class="resize-module-container__background resize-module-container__background_pos_r"></div> </div> <div class="resize-module-container__body-image-area resize-module-container__file_place-front_t_area"> <div class="scale-cube scale-cube_pos_tl"></div> <div class="scale-cube scale-cube_pos_tr"></div> <div class="scale-cube scale-cube_pos_bl"></div> <div class="scale-cube scale-cube_pos_br"></div> </div> </div> </div> </div> <div class="resize-module-container__footer"> <div class="resize-module-container__button resize-module-container__button_type-confirm"> <span>Сохранить изменения</span> </div> <div class="resize-module-container__button resize-module-container__button_type-deny"> <span>Вернуться назад</span> </div> </div> <canvas class="canvas_crop"></canvas> </div> '),document.body.appendChild(t);var n,o,i,r,a,c,l,d,u,s,_=document.querySelectorAll('input[class="imageResizeAndCrop"]'),m=new DataTransfer,v=document.querySelector(".resize-module-container__circle-box_type_wheel"),p=document.querySelector(".resize-module-container__circle-box_type_arrows"),h=v.getBoundingClientRect(),y=p.getBoundingClientRect(),b=500,f=500,g=0,z=0,w=1,x=0,k="area",S=document.querySelector(".resize-module-container__body-paragraph"),E={wheel:"Вы можете изменять размер изображения при помощи колёсика мыши",arrows:"Вы можете изменять размер изображения при помощи стягивания углов",area:"Вы можете выделить необходимый участок изображения"},L=document.querySelector(".resize-module-container__file_place-back_t_w"),q=document.querySelector(".resize-module-container__file_place-front_t_w"),C=document.querySelector(".resize-module-container__file_place-back_t_a"),B=document.querySelector(".resize-module-container__file_place-front_t_a"),R=document.querySelector(".resize-module-container__file_place-back_t_area"),Y=document.querySelector(".resize-module-container__file_place-front_t_area"),M=0,X=0,A=0,I=0;t.addEventListener("selectstart",(function(e){return e.preventDefault()}));var P=new FileReader,D=document.querySelectorAll("[data-type]"),F=function(e){h=v.getBoundingClientRect(),y=p.getBoundingClientRect(),b=h.width+y.width,f=h.height+y.height;var t=R.getBoundingClientRect();L.style.backgroundSize=e+"px",q.style.backgroundSize=e+"px",C.style.backgroundSize=e+"px",B.style.backgroundSize=e+"px",Y.style.height=t.height-M-A+"px",Y.style.width=t.width-X-I+"px",document.querySelector(".resize-module-container__background_pos_t").style.height=M+"px",document.querySelector(".resize-module-container__background_pos_b").style.height=A+"px",document.querySelector(".resize-module-container__background_pos_l").style.top=M+"px",document.querySelector(".resize-module-container__background_pos_l").style.bottom=A+"px",document.querySelector(".resize-module-container__background_pos_l").style.width=X+"px",document.querySelector(".resize-module-container__background_pos_r").style.top=M+"px",document.querySelector(".resize-module-container__background_pos_r").style.bottom=A+"px",document.querySelector(".resize-module-container__background_pos_r").style.width=I+"px"},T=function(e,t){h=v.getBoundingClientRect(),y=p.getBoundingClientRect(),b=h.width+y.width,f=h.height+y.height,L.style.backgroundPosition=e+" "+t,q.style.backgroundPosition=e+" "+t,C.style.backgroundPosition=e+" "+t,B.style.backgroundPosition=e+" "+t,Y.style.backgroundPosition=-X+"px "+-M+"px",Y.style.left=X+"px",Y.style.right=I+"px",Y.style.top=M+"px",Y.style.bottom=A+"px"};!function(){_.forEach((function(a){a.addEventListener("change",(function(){n=a,function(){var o,i,a,c;o=this,i=void 0,c=function(){var o,i;return function(e,t){var n,o,i,r,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:c(0),throw:c(1),return:c(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function c(c){return function(l){return function(c){if(n)throw new TypeError("Generator is already executing.");for(;r&&(r=0,c[0]&&(a=0)),a;)try{if(n=1,o&&(i=2&c[0]?o.return:c[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,c[1])).done)return i;switch(o=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return a.label++,{value:c[1],done:!1};case 5:a.label++,o=c[1],c=[0];continue;case 7:c=a.ops.pop(),a.trys.pop();continue;default:if(!((i=(i=a.trys).length>0&&i[i.length-1])||6!==c[0]&&2!==c[0])){a=0;continue}if(3===c[0]&&(!i||c[1]>i[0]&&c[1]<i[3])){a.label=c[1];break}if(6===c[0]&&a.label<i[1]){a.label=i[1],i=c;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(c);break}i[2]&&a.ops.pop(),a.trys.pop();continue}c=t.call(e,a)}catch(e){c=[6,e],o=0}finally{n=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([c,l])}}}(this,(function(a){switch(a.label){case 0:return t.classList.remove("resize-module_disable"),o=n.files[0],[4,e(o,{quality:Math.min(1,2097152/o.size),type:"image/jpeg"})];case 1:return i=a.sent(),P.readAsDataURL(i),P.addEventListener("load",(function(){(r=new Image).src=P.result,r.addEventListener("load",u),window.addEventListener("resize",s)})),H(),[2]}}))},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{l(c.next(e))}catch(e){t(e)}}function r(e){try{l(c.throw(e))}catch(e){t(e)}}function l(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(n,r)}l((c=c.apply(o,i||[])).next())}))}()})),o=Number(a.getAttribute("data-target-width")),i=Number(a.getAttribute("data-target-height"))}));var u=function(){h=v.getBoundingClientRect(),y=p.getBoundingClientRect(),b=h.width+y.width,f=h.height+y.height,b+f===0&&(b=500,f=500),a=r.naturalWidth,c=r.naturalHeight,L.style.backgroundImage="url('"+P.result+"')",q.style.backgroundImage="url('"+P.result+"')",C.style.backgroundImage="url('"+P.result+"')",B.style.backgroundImage="url('"+P.result+"')";var e=a/Math.min(window.innerWidth,900),t=c/Math.min(window.innerHeight-200,600),n=Math.min(e,t);R.style.width=a/n-88+"px",R.style.height=c/n-88+"px",R.style.backgroundSize=a/n-88+"px "+(c/n-88)+"px",R.style.backgroundImage="url('"+P.result+"')";var i=R.getBoundingClientRect();i.width<=300?(X=0,M=0,I=0,A=i.height-i.width):(X=50,M=50,I=i.width-300,A=i.height-300),z=0,g=0,w=b*Math.max(b/o,1)/Math.min(a,c),x=0,d=c*w,F(l=a*w),T("50%","50%")},s=function(){window.innerWidth<=720&&(k="area",H()),window.requestAnimationFrame(u)};window.removeEventListener("resize",s);var Y,j,H=function(){for(var e=0,t=Array.from(D);e<t.length;e++){var n=t[e].dataset.type;document.querySelector(".resize-module-container__body_type_"+n).style.display="none",document.querySelector(".zoom-variant-item_type_"+n).style.backgroundColor="transparent"}S.textContent=E[k],document.querySelector(".resize-module-container__body_type_"+k).style.display="flex",document.querySelector(".zoom-variant-item_type_"+k).style.backgroundColor="var(--color-active)"};!function(){for(var e=function(e){var t=e.dataset.type;document.querySelector(".zoom-variant-item_type_"+t).addEventListener("click",(function(){k=t,H()}))},t=0,n=Array.from(D);t<n.length;t++)e(n[t])}(),Y=document.querySelector(".resize-module-container__button_type-confirm"),j=document.querySelector(".canvas_crop"),Y.addEventListener("click",(function(){if("area"===k){var e=R.getBoundingClientRect(),l=a/e.width,d=c/e.height;j.width=o,j.height=i,(u=j.getContext("2d")).drawImage(r,X*l,M*d,a-X*l-I*l,c-M*d-A*d,0,0,j.width,j.height)}else{j.width=o,j.height=i;var u=j.getContext("2d"),s=a/2-g/w-b/2/w,_=c/2-z/w-f/2/w,v=b/w,p=f/w;u.drawImage(r,s,_,v,p,0,0,j.width,j.height)}j.toBlob((function(e){m.items.clear(),m.items.add(new File([e],"updatedFile.png",{type:"image/png"})),n.files=m.files,t.classList.add("resize-module_disable")}))})),function(){window.removeEventListener("resize",s);var e=function(){t.classList.add("resize-module_disable"),n.files=null,n.value=""};document.querySelector(".resize-module-container__button_type-deny").addEventListener("click",e),document.querySelector(".resize-module-container__close-button").addEventListener("click",e)}()}(),function(){var e,t,n,o,i,r=0;n=function(n){w=1+x+(n.clientX-e+(n.clientY-t))/(100+Math.sqrt((n.clientX-e)*(n.clientX-e)+(n.clientY-t)*(n.clientY-t))),4===r&&(w=1+x-(n.clientX-e+(n.clientY-t))/(100+Math.sqrt((n.clientX-e)*(n.clientX-e)+(n.clientY-t)*(n.clientY-t)))),(a*w<b||c*w<f)&&(w=b/Math.min(a,c),x=w-1),l=a*w,d=c*w,document.querySelector(".resize-module-container__zoom-button_place_top").style.margin=(32*w+4)/(w+4)+"px",document.querySelector(".resize-module-container__zoom-button_place_bottom").style.margin=(32*w+4)/(w+4)+"px",v(),F(l)},o=function(o){e=o.clientX,t=o.clientY,document.addEventListener("mousemove",n)},document.querySelector(".resize-module-container__zoom-button_place_top").addEventListener("mousedown",(function(e){r=2,o(e)})),document.querySelector(".resize-module-container__zoom-button_place_bottom").addEventListener("mousedown",(function(e){r=4,o(e)})),document.addEventListener("mouseup",(function(){x=w-1,document.removeEventListener("mousemove",n)})),i=function(e){w-=e.deltaY/2400,a*w>=b&&c*w>=f?(l=a*w,d=c*w):w+=e.deltaY/2400,v(),F(l)},"onwheel"in document?L.addEventListener("wheel",i):"onmousewheel"in document?L.addEventListener("mousewheel",i):L.addEventListener("MozMousePixelScroll",i),function(){var e,t,n,o,i=function(i){n=e,o=t,Object.prototype.hasOwnProperty.call(i,"touches")?(e=i.touches[0].clientX,t=i.touches[0].clientY):(e=i.clientX,t=i.clientY)},a=function(n){n.preventDefault();var o=R.getBoundingClientRect();i(n),1===r?(u=X+o.left,s=o.height+o.top-A):2===r?(u=o.width+o.left-I,s=o.height+o.top-A):3===r?(u=o.width+o.left-I,s=M+o.top):4===r?(u=X+o.left,s=M+o.top):(u=e,s=t,M<=t-o.top&&A<=o.top+o.height-t&&X<=e-o.left&&I<=o.left+o.width-e&&(r=-1)),document.addEventListener("touchmove",c),document.addEventListener("mousemove",c)};R.addEventListener("mousedown",a),R.addEventListener("touchstart",a),document.querySelector(".scale-cube_pos_tr").addEventListener("mousedown",(function(){r=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("mousedown",(function(){r=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("mousedown",(function(){r=3})),document.querySelector(".scale-cube_pos_br").addEventListener("mousedown",(function(){r=4})),document.querySelector(".scale-cube_pos_tr").addEventListener("touchstart",(function(){r=1})),document.querySelector(".scale-cube_pos_tl").addEventListener("touchstart",(function(){r=2})),document.querySelector(".scale-cube_pos_bl").addEventListener("touchstart",(function(){r=3})),document.querySelector(".scale-cube_pos_br").addEventListener("touchstart",(function(){r=4}));var c=function(a){var c=R.getBoundingClientRect();i(a);var d=0,_=0,m=0;-1!==r&&(1===r?(X=u,A=c.height-s):2===r?(I=c.width-u,A=c.height-s):3===r?(I=c.width-u,M=s):4===r&&(X=u,M=s),e>=u?(d=1,X=u-c.left,I=c.width+c.left-e):(d=-1,X=e-c.left,I=c.width+c.left-u),t>=s?(_=1,M=s-c.top,A=c.height+c.top-t):(_=-1,M=t-c.top,A=c.height+c.top-s),1===d&&-1===_?m=1:-1===d&&-1===_?m=2:-1===d&&1===_?m=3:1===d&&1===_&&(m=4)),1!==m&&2!==m||(M=t-c.top)<0&&(M=0),3!==m&&4!==m||(A=c.top+c.height-t)<0&&(A=0),2!==m&&3!==m||(X=e-c.left)<0&&(X=0),4!==m&&1!==m||(I=c.left+c.width-e)<0&&(I=0);var v=c.width-X-I,p=c.height-M-A;1===m?v<=p?M+=p-v:I+=v-p:2===m?v<=p?M+=p-v:X+=v-p:3===m?v<=p?A+=p-v:X+=v-p:4===m?v<=p?A+=p-v:I+=v-p:-1===r&&(X+=e-n,I-=e-n,M+=t-o,A-=t-o,n=e,o=t),M<0&&(A+=M,M=0),X<0&&(I+=X,X=0),A<0&&(M+=A,A=0),I<0&&(X+=I,I=0),F(l),T(g,z)},d=function(){r=0,document.removeEventListener("mousemove",c),document.removeEventListener("touchmove",c)};document.addEventListener("mouseup",d),document.addEventListener("touchend",d)}();var _,m,v=function(){2*g+b>l?g=l/2-b/2:2*g-b<-l&&(g=-l/2+b/2),2*z+f>d?z=d/2-f/2:2*z-f<-d&&(z=-d/2+f/2),T("calc(50% + "+g+"px)","calc(50% + "+z+"px)")};_=function(n){var o=n.clientX,i=n.clientY;g=o-e,z=i-t,v()},m=function(n){e=n.clientX-g,t=n.clientY-z,document.addEventListener("mousemove",_)},L.addEventListener("mousedown",m),C.addEventListener("mousedown",m),R.addEventListener("mousedown",m),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",_)}))}()})();